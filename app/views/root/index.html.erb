<div class="row-fluid">
  <div class="span4">
    <% if @page.present? %>
      <div class="tinymce_format">
        <%= simple_format_no_tags(@page.content) %>
      </div>
    <% end %>
  </div>
  
  <div class="span4">
    <%
      vimeo_id = '97171156'
      vimeo_id = '97165638' if I18n.locale != :ka
    %>

    <%= link_to t('.skip_movie'), '#why_monitor_text', :class => 'accessibly-hidden' %>
    <iframe src="//player.vimeo.com/video/<%= vimeo_id %>" width="500" height="281" frameborder="0" webkitallowfullscreen mozallowfullscreen allowfullscreen></iframe>

  </div>

  <div class="span4">
    <% if @stats.present? %>
      <div>
        <h3><%= t('.header_stats') %></h3>
        <div>
          <%= t('app.common.num_places_overall', :num => @stats[:places_with_evals]) %>
        </div>
        <div>
          <%= "#{t('app.common.certified_overall', :num => @stats[:certified_results]['count'])}:" %>
          <%= format_summary_result(@stats[:certified_results], is_summary: true, is_certified: true) %>
        </div>
        <div>
          <%= "#{t('app.common.public_overall', :num => @stats[:public_results]['count'])}:" %>
          <%= format_summary_result(@stats[:public_results], is_summary: true, is_certified: false) %>
        </div>
      </div>    
    <% end %>
  </div>
</div>

<div id="front-page" class="row-fluid">
  <div class="span4" id="search">
    <div class="row-fluid">
      <div class="span6">
        <div class="filter_box">
          <h3><%= t('.header_filter_place_search') %></h3>
            <%= text_field_tag :filter_place_search, params[:place_search], :placeholder => t('.placeholder_place_search') %>
        </div>
      </div>
      <div class="span6">    
        <div class="filter_box">
          <h3><%= t('.header_filter_address_search') %></h3>
            <%= text_field_tag :filter_address_search, params[:address_search], :placeholder => t('.placeholder_address_search') %>
        </div>
      </div>
    </div>
    <div class="row-fluid">
      <div class="span6">
        <div class="filter_box">
          <h3><%= t('.header_filter_venue') %></h3>
            <%= select_tag(:filter_venue, 
                options_for_select(@venue_categories.map{|x| ["#{x[:venue_category]} (#{x[:count]})", x.id]}, params[:venue_category_id]),
                :include_blank => true,
                :'data-placeholder' => t('.placeholder_venue'), 
                :style => 'width: 100%') %>
        </div>
      </div>
      <div class="span6">    
        <div class="filter_box">
          <h3><%= t('.header_filter_district') %></h3>
            <%= select_tag(:filter_district, 
                options_for_select(@districts.map{|x| ["#{x[:district]} (#{x[:count]})", x.id]}, params[:district_id]),
                :include_blank => true,
                :'data-placeholder' => t('.placeholder_district'), 
                :style => 'width: 100%') %>
        </div>
      </div>
    </div>
    <div class="row-fluid">
      <div class="span6">
        <div class="filter_box">    
          <h3><%= t('.header_filter_evaluations') %></h3>
          <%= label_tag :filter_evaluations do %>
            <%= check_box_tag :filter_evaluations, '1', checked = params[:places_with_evaluation] %>  
            <%= t('.placeholder_evaluations') %>
          <% end %>
        </div>
      </div>
      <div class="span6">    
        <div class="filter_box" id="disability_filter" <%= params[:places_with_evaluation] == false ? "style=display:none;" : ''%> >    
          <h3><%= t('.header_filter_disability') %></h3>
            <%= select_tag(:filter_disability, 
                options_for_select(@disabilities.map{|x| ["#{x[:disability]} (#{x[:count]})", x.id]}, params[:eval_type_id]),
                :include_blank => true,
                :'data-placeholder' => t('.placeholder_disability'), 
                :style => 'width: 100%') %>
        </div>
      </div>
    </div>
    
    <div class="row-fluid" id="filter_buttons">
      <div class="span6">
        <%= link_to t('.search'), root_path, :class => 'search', :id => 'btn_search' %>
      </div>
      <div class="span6">    
        <% if params[:venue_category_id].present? || params[:eval_type_id].present? || 
              params[:places_with_evaluation] == false || params[:place_search].present? || params[:address_search].present?  %>
          <p id="clear_filters">
            <%= link_to t('.clear_filters'), root_path, :class => 'reset_filters' %>
          </p>
        <% end %>
      </div>
    </div>


    <div id="search_results">
      <div id="selection_results">
        <h2><%= t('.header_results') %>:</h2>
        <% if @places.present? %>
          <% @places.each do |place| %>
            <div class="place-item">
              <h3>
                <%= link_to place[:place], place_path(place) %>
              </h3>
              <h4><%= place[:venue] %></h4>
              
              <% if place[:address].present? %>
                <p>
                  <%= place[:address] %>
                </p>
              <% end %>

              <% if @place_summaries.present? 
                  summary_index = @place_summaries.index{|x| x.place_id == place.id && x.is_certified == true}
                  if summary_index.present? %>
                    <div>
                      <%= "#{t('app.common.certified')}:" %>
                      <%= format_summary_result(@place_summaries[summary_index].to_summary_hash, is_summary: true, is_certified: true) %>
                    </div>
               <% end 
                  summary_index = @place_summaries.index{|x| x.place_id == place.id && x.is_certified == false}
                  if summary_index.present? %>
                    <div>
                      <%= "#{t('app.common.public')}:" %>
                      <%= format_summary_result(@place_summaries[summary_index].to_summary_hash, is_summary: true, is_certified: false) %>
                    </div>
                  <% end %>
               <% end %>
              <div class="links">
                <%= link_to t('app.common.view_place'), place_path(place), :class => 'view_more', 
                  :title => t('app.common.view_place_title', :place => place[:place]) %>
                <%= link_to t('app.common.add_evaluation'), evaluation_place_path(place), :class => 'add_evaluation',
                  :title => t('app.common.add_evaluation_title', :place => place[:place]) %>
              </div>
            </div>
          <% end %>
        <% else %>
          <p>
            <%= t('.no_places') %>
          </p>
        <% end %>
      </div>
    </div>
  </div>
  <div class="span8">
    <a href="#footer" class="accessibly-hidden"><%= t('.jump.skip_map') %></a>
    <div id="map"></div>
  </div>
</div>
