<!DOCTYPE html>
<html lang="<%= I18n.locale %>">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title><%= content_for?(:title) ? "#{yield(:title)} | #{t('app.common.app_name')}" :
				t('app.common.app_name') %></title>
    <%= csrf_meta_tags %>
	  <%= include_gon %>

    <!-- Le HTML5 shim, for IE6-8 support of HTML elements -->
    <!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js" type="text/javascript"></script>
    <![endif]-->

    <%= stylesheet_link_tag "application", :media => "all" %>
		<!--[if IE 6]><%= stylesheet_link_tag 'ie6' %><![endif]-->
	  <!--[if IE 7]><%= stylesheet_link_tag 'ie7' %><![endif]-->

    <% if @show_map %>
      <link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet-0.6.4/leaflet.css" />
      <!--[if lte IE 8]>
         <link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet-0.6.4/leaflet.ie.css" />
      <![endif]-->
    <% end %>
         
    <!-- For all other devices -->
    <!-- Size should be 32 x 32 pixels -->
    <%= favicon_link_tag '/favicon.ico', :rel => 'shortcut icon' %>
  </head>
  <body>
    <!-- Navigation start -->
    <ul class="accessibly-hidden" role="menubar">
      <li><a href="#main"><%= t('.jump.main') %></a></li>
      <% if params[:controller] == 'root' && params[:action] == 'index' %>
        <li><a href="#search"><%= t('.jump.search') %></a></li>
        <li><a href="#search_results"><%= t('.jump.search_results') %></a></li>
      <% end %>
      <li><a href="#menu"><%= t('.jump.menu') %></a></li>
      <% if user_signed_in? %>
        <li><a href="#admin_menu"><%= t('jump.admin_menu') %></a></li>
      <% end %>
      <li><a href="#language_switcher"><%= t('.jump.language') %></a></li>
      <li><a href="#footer"><%= t('jump.footer') %></a></li>
    </ul>
    <!-- Navigation end -->
    
    <!-- Main menu start -->
    <div id="#menu" class="navbar navbar-fixed-top" role="menubar">
      <div class="navbar-inner">
        <div class="container-fluid">
          <a class="btn btn-navbar" data-target=".nav-collapse" data-toggle="collapse">
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </a>
          <%= link_to(t('app.common.app_name'), root_path(:locale => I18n.locale), :class=>"brand font", :role => 'menuitem')%>

          <ul class="nav">
            <li role="menuitem"><%= link_to t('.add_place'), new_place_path, :class => 'add_evaluation' %></li>
          </ul>

          <div class="container-fluid nav-collapse">
	          <ul class="nav pull-right">
              <li role="menuitem"><%= link_to(t('.why_monitor'), why_monitor_path)  %></li>
              <li role="menuitem"><%= link_to(t('.methodology'), methodology_path)  %></li>
		          <% if user_signed_in? %>
				        <li id="admin_menu" class="dropdown" role="menuitem" aria-haspopup="true">
				          <a href="#" class="dropdown-toggle" data-toggle="dropdown">
		                <%= current_user.nickname %>
		                <b class="caret"></b>
				          </a>
				          <ul class="dropdown-menu" role="menu">
                    <% if current_user.role?(User::ROLES[:site_admin]) %>
						          <li role="menuitem">
				   		         <%= link_to t('.admin'), admin_path %>
										  </li>
                    <% end %>
						        <li role="menuitem">
				 		         <%= link_to t('.settings'), settings_path %>
										</li>
						        <li role="menuitem">
				 		         <%= link_to t('.sign_out'), destroy_user_session_path, :method => :delete %>
										</li>
				          </ul>
				        </li>
              <% else %>
                <li role="menuitem"><%= link_to(t('helpers.links.sign_in'), new_user_session_path)  %></li>
		          <% end %>
							<% I18n.available_locales.each do |locale| %>
								<% if locale != I18n.locale %>
									<li id="language_switcher" role="menuitem"><%= link_to t("app.language.#{locale}"), params.merge(:locale => locale) %></li>
								<% end %>
							<% end %>
	          </ul>
          </div><!--/.nav-collapse -->
        </div>
      </div>
    </div>
    <!-- Main menu end -->

    <!-- Main content start -->
		<div id="wrapper">
		  <div class="container-fluid">
		    <div class="content">
		      <div class="row-fluid">
		         <div id="main" class="span12">
							<% flash.each do |key, msg| %>
								<div class="alert <%= flash_translation(key) %> fade in">
									<a href="#" data-dismiss="alert" class="close">Ã—</a>
									<%= msg %>
								</div>
							<% end %>


							<% if content_for?(:title) %>
								<div class="page-header">
								  <div class="block">
			              <h1>
										  <%= yield(:title) %>
									  </h1>
									</div>
								</div>
							<% end %>

	            <%= yield %>
	          </div><!--/span-->
		      </div><!--/row-->
		    </div><!--/content-->
		   </div> <!-- /container -->
		</div><!--/wrapper-->
    <!-- Main content end -->

    <div class="push"><!--//--></div>

    <!-- Footer start -->
    <footer id="footer" class="clear">
			<div id="left">&copy; <%= Time.now.year %></div>
		  <div id="middle">
				&nbsp;
			</div>
			<div id="right" class="clear">
				<%= link_to(image_tag("jumpstart-logo.png"), "http://www.jumpstart.ge", :target => "_blank",
						:title => t(".js_link_title")	) %>
			</div>
    </footer>
    <!-- Footer end -->

    <!-- Javascripts
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <% if @show_map %>
      <script src="http://cdn.leafletjs.com/leaflet-0.6.4/leaflet.js"></script>
    <% end %>
    <%= javascript_include_tag "application" %>
		<script type="text/javascript">
			I18n.defaultLocale = "<%= I18n.default_locale %>";
			I18n.locale = "<%= I18n.locale %>";
		</script>

    <% if params[:controller] == 'places' && params[:action] == 'upload_photos' %>
      <script>
        var fileUploadErrors = {
        maxFileSize: 'File is too big',
        minFileSize: 'File is too small',
        acceptFileTypes: 'Filetype not allowed',
        maxNumberOfFiles: 'Max number of files exceeded',
        uploadedBytes: 'Uploaded bytes exceed file size',
        emptyResult: 'Empty file upload result'
        };
      </script>

      <!-- The template to display files available for upload -->
      <script id="template-upload" type="text/x-tmpl">
        {% for (var i=0, file; file=o.files[i]; i++) { %}
        <tr class="template-upload fade">
          <td class="preview"><span class="fade"></span></td>
          <td class="name"><span>{%=file.name%}</span></td>
          <td class="size"><span>{%=o.formatFileSize(file.size)%}</span></td>
          {% if (file.error) { %}
          <td class="error" colspan="2"><span class="label label-important">{%=locale.fileupload.error%}</span> {%=locale.fileupload.errors[file.error] || file.error%}</td>
          {% } else if (o.files.valid && !i) { %}
          <td>
            <div class="progress progress-success progress-striped active"><div class="bar" style="width:0%;"></div></div>
          </td>
          <td class="start">{% if (!o.options.autoUpload) { %}
            <button class="btn btn-primary">
              <i class="icon-upload icon-white"></i>
              <span><%= t('app.buttons.start') %></span>
            </button>
            {% } %}</td>
          {% } else { %}
          <td colspan="2"></td>
          {% } %}
          <td class="cancel">{% if (!i) { %}
            <button class="btn btn-warning">
              <i class="icon-ban-circle icon-white"></i>
              <span><%= t('app.buttons.cancel') %></span>
            </button>
            {% } %}</td>
        </tr>
        {% } %}
      </script>
      <!-- The template to display files available for download -->
      <script id="template-download" type="text/x-tmpl">
        {% for (var i=0, file; file=o.files[i]; i++) { %}
          <tr class="template-download fade">
            {% if (file.error) { %}
              <td></td>
              <td class="name"><span>{%=file.name%}</span></td>
              <td class="size"><span>{%=o.formatFileSize(file.size)%}</span></td>
              <td class="error" colspan="2"><span class="label label-important">{%=locale.fileupload.error%}</span> {%=locale.fileupload.errors[file.error] || file.error%}</td>
              {% } else { %}
              <td class="preview">{% if (file.thumbnail_url) { %}
                <a href="{%=file.url%}" title="{%=file.name%}" rel="gallery" download="{%=file.name%}"><img src="{%=file.thumbnail_url%}"></a>
                {% } %}</td>
              <td class="name">
                <a href="{%=file.url%}" title="{%=file.name%}" rel="{%=file.thumbnail_url&&'gallery'%}" download="{%=file.name%}">{%=file.name%}</a>
              </td>
              <td class="size"><span>{%=o.formatFileSize(file.size)%}</span></td>
              <td colspan="2"></td>
              {% } %}
            <td class="delete">
              <button class="btn btn-danger" data-type="{%=file.delete_type%}" data-url="{%=file.delete_url%}">
                <i class="icon-trash icon-white"></i>
                <span><%= t('app.buttons.delete') %></span>
              </button>
            </td>
          </tr>
          {% } %}
      </script>
    <% end %>

		<% if Rails.env.production? %>
			<!-- insert google analytics for production site here -->
		<% elsif Rails.env.staging? %>
			<!-- insert google analytics for staging site here -->
		<% end %>

  </body>
</html>
